0. Se termina docker:
$ENV:HOME = 'c:/Users/MT DIAMOND'
docker compose down

1. Se lanza la última versión correcta:

docker run -p 2222:22 -p 8081:8081 --rm -it ejfdelgado/policiavr:v1.97

2. Se ingresa por ssh para actualizar el código:

ssh root@localhost -p 2222
root123

3. Se actualiza el código y se compila

cd ~/desarrollo/ejflab && git pull && npm install && npm run build_local

4. Se sale de ssh y se hace commit de la versión docker:

exit
docker ps

Se debe tomar el id del proceso para reemplazarlo en el siguiente comando después de -p e incrementar la version al final

docker commit -m "fix bug" -p d756946c634b  ejfdelgado/policiavr:v1.98

5. Crear el tag para subir a gcr.io

docker tag ejfdelgado/policiavr:v1.98 gcr.io/ejfexperiments/policiavr:v1.98

6. Subirlo a gcr.io

docker push gcr.io/ejfexperiments/policiavr:v1.98

6.1. Apagar la instancia de docker:

docker stop d756946c634b

7. Actualizar la versión en terraform en run.tf

8. Agregar credenciales de google:

export GOOGLE_APPLICATION_CREDENTIALS=/home/ejfdelgado/desarrollo/ejflab/llaves/ejfexperiments-c2ef2a890ca5.json
gcloud config set project ejfexperiments
gcloud config set account edgar.jose.fernando.delgado@gmail.com

9. Desde la carpeta de terraform subir el proyecto:

cd /home/ejfdelgado/desarrollo/ejflab/containers/police-docker/terra

terraform apply

yes

Listo!

Si desea ver la imagen en gcr.io:
https://console.cloud.google.com/gcr/images/ejfexperiments/global/policiavr?hl=es&project=ejfexperiments



Borrar imagenes viejas:
docker container ls